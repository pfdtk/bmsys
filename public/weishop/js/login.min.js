!function(a,b){var d={};d.cache_publickey="publickey";d.username="";d.password="";function c(f,g,e){this.usenameId=f;this.passwdId=g;this.submitId=e;this.disabledClass="";this.message="登录成功"}c.prototype.doLogin=function(){var e=this.submitId;var f=this;b.ajax({type:"get",url:"/login/proc",data:{username:d.username,password:d.password},dataType:"jsonp",jsonp:"callback",jsonpCallback:"callback",headers:{"X-XSRF-TOKEN":b('meta[name="csrf-token"]').attr("content")},success:function(g){if(!g.result){f.prelogin(f.disabledClass);f.alert(g.msg)}if(g.result&&typeof g.jumpUrl!="undefined"){window.location.href=g.jumpUrl}else{if(g.result){window.location.href="/"}}},beforeSend:function(){b("#"+e).html("登录中...")},timeout:30000,complete:function(h,g){if(g=="timeout"){f.alert("登录超时，请重试！")}b("#"+e).html("登录")}})};c.prototype.checkParams=function(){d.username=b("#"+this.usenameId).val();d.password=b("#"+this.passwdId).val();if(d.username==""){this.message="请输入用户名";return false}if(d.password==""){this.message="请输入密码";return false}var e=b("#"+this.submitId).data(d.cache_publickey);if(typeof e=="undefined"){this.message="登录失败，刷新重试";return false}d.password=CryptoJS.MD5(d.password)+e;d.password=(""+CryptoJS.MD5(d.password)).toUpperCase();return true};c.prototype.prelogin=function(f){this.disabledClass=f;var e=this.submitId;var g=this;b.ajax({type:"get",url:"/login/prelogin",data:"",dataType:"jsonp",jsonp:"callback",jsonpCallback:"callback",success:function(h){b("."+f).attr("disabled",false);b("#"+e).data(d.cache_publickey,h.pKey);b('meta[name="csrf-token"]').attr("content",h.a)},beforeSend:function(){b("."+f).attr("disabled",true)},timeout:10000,complete:function(i,h){if(h=="timeout"){g.alert("初始化失败，刷新页面重试")}}})};c.prototype.alert=function(e){a.alert(e)};a.Login=c}(window,jQuery);